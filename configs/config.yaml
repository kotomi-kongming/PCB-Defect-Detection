# 训练配置
model:
  name: 'yolov8n.pt'  # 可选: yolov8n, yolov8s, yolov8m, yolov8l, yolov8x
  type: 'detect'

# 数据集配置
data:
  dataset: 'configs/datasets/dspcbsd.yaml'  # DsPCBSD+ 数据集
  img_size: 320
  batch_size: 8
  workers: 6
  cache_images: 'ram'
  close_mosaic: 8

# 训练参数
training:
  epochs: 50
  patience: 8
  device: 'cpu'  # 当前环境仅CPU可用
  freeze_layers: 6
  amp: true
  cosine_lr: true
  dropout_rate: 0.05
  dropout_layers: 2
  pruning_amount: 0.1
  copy_paste: 0.1
  mixup: 0.05
  box: 1.0
  cls: 0.5
  dfl: 1.0
  auto_augment: 'randaugment'
  erasing: 0.2
  cutmix: 0.05
  virtual_batch: 64
  non_hb_extra_copies: 1
  negative_extra_copies: 0
  hb_class_keyword: 'Hole-Break'
  
  # 优化器
  optimizer: 'SGD'  # 可选: SGD, Adam, AdamW
  lr0: 0.01  # 初始学习率
  lrf: 0.01  # 最终学习率 (lr0 * lrf)
  momentum: 0.937
  weight_decay: 0.0005
  
  # 数据增强
  hsv_h: 0.015  # 色调增强
  hsv_s: 0.7    # 饱和度增强
  hsv_v: 0.4    # 明度增强
  degrees: 0.0  # 旋转角度
  translate: 0.1  # 平移
  scale: 0.4    # 缩放
  shear: 0.0    # 剪切
  perspective: 0.0  # 透视变换
  flipud: 0.0   # 上下翻转概率
  fliplr: 0.5   # 左右翻转概率
  mosaic: 0.8   # Mosaic增强概率

  # 多阶段训练策略（CPU场景）
  stages:
    - name: 'warmup'
      epochs: 10
      freeze_layers: 6
      dropout_rate: 0.0
      dropout_layers: 0
      pruning_amount: 0.0
      lr0: 0.01
      lrf: 0.01
      mosaic: 0.0
      copy_paste: 0.0
      mixup: 0.0
      cutmix: 0.0
      erasing: 0.0
      auto_augment: null
      scale: 0.3
      box: 1.0
      cls: 0.5
      dfl: 1.0
      close_mosaic: 0
      fraction: 0.5
      run_name: 'train_stage_warmup'
    - name: 'coarse'
      epochs: 25
      freeze_layers: 3
      dropout_rate: 0.05
      dropout_layers: 2
      pruning_amount: 0.1
      lr0: 0.011
      lrf: 0.011
      mosaic: 0.5
      copy_paste: 0.15
      mixup: 0.05
      cutmix: 0.05
      erasing: 0.2
      auto_augment: 'randaugment'
      scale: 0.5
      box: 1.05
      cls: 0.5
      dfl: 1.0
      close_mosaic: 6
      fraction: 1.0
      run_name: 'train_stage_coarse'
    - name: 'finetune'
      epochs: 15
      freeze_layers: 0
      dropout_rate: 0.0
      dropout_layers: 0
      pruning_amount: 0.0
      lr0: 0.006
      lrf: 0.006
      mosaic: 0.0
      copy_paste: 0.0
      mixup: 0.0
      cutmix: 0.0
      erasing: 0.05
      auto_augment: null
      scale: 0.4
      box: 1.0
      dfl: 1.0
      cls: 0.45
      close_mosaic: 1
      conf_thres: 0.001
      iou_thres: 0.7
      run_name: 'train_stage_finetune'

# 验证参数
validation:
  val_interval: 1
  save_period: 5
  conf_thres: 0.001
  iou_thres: 0.65
  split: 'val'

# 输出路径
paths:
  weights: 'models/'
  results: 'results/'
  logs: 'logs/'

# 报告配置
report:
  output: 'results/eval_report.md'
  include_images:
    - BoxPR_curve.png
    - BoxP_curve.png
    - BoxR_curve.png
    - BoxF1_curve.png
    - confusion_matrix.png
