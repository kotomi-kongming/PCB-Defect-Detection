# 训练配置
model:
  name: 'yolov8n.pt'  # 可选: yolov8n, yolov8s, yolov8m, yolov8l, yolov8x
  type: 'detect'

# 数据集配置
data:
  dataset: 'configs/datasets/dspcbsd.yaml'  # PCB缺陷数据集配置
  img_size: 384
  batch_size: 16
  workers: 4
  cache_images: 'disk'
  close_mosaic: 8

# 训练参数
training:
  epochs: 80
  patience: 15  # Early stopping
  device: 'cpu'  # 当前环境仅CPU可用
  freeze_layers: 6
  amp: true
  cosine_lr: true
  dropout_rate: 0.15
  dropout_layers: 3
  pruning_amount: 0.2
  copy_paste: 0.1
  mixup: 0.05
  box: 1.0
  cls: 0.5
  dfl: 1.0
  auto_augment: 'randaugment'
  erasing: 0.2
  cutmix: 0.05
  virtual_batch: 64  # 通过 nbs 控制梯度累积的等效批量大小
  non_hb_extra_copies: 1  # 非HB类样本在训练列表中的额外复制次数
  hb_class_keyword: 'Hole-Break'  # 用于匹配HB类别名称的关键词
  
  # 优化器
  optimizer: 'SGD'  # 可选: SGD, Adam, AdamW
  lr0: 0.01  # 初始学习率
  lrf: 0.01  # 最终学习率 (lr0 * lrf)
  momentum: 0.937
  weight_decay: 0.0005
  
  # 数据增强
  hsv_h: 0.015  # 色调增强
  hsv_s: 0.7    # 饱和度增强
  hsv_v: 0.4    # 明度增强
  degrees: 0.0  # 旋转角度
  translate: 0.1  # 平移
  scale: 0.4    # 缩放
  shear: 0.0    # 剪切
  perspective: 0.0  # 透视变换
  flipud: 0.0   # 上下翻转概率
  fliplr: 0.5   # 左右翻转概率
  mosaic: 0.8   # Mosaic增强概率

  # 多阶段训练策略（CPU场景）
  stages:
    - name: 'coarse'
      epochs: 40
      freeze_layers: 6
      dropout_rate: 0.2
      dropout_layers: 3
      pruning_amount: 0.2
      lr0: 0.012
      lrf: 0.012
      mosaic: 0.85
      copy_paste: 0.25
      mixup: 0.18
      cutmix: 0.2
      erasing: 0.45
      auto_augment: 'randaugment'
      scale: 0.6
      box: 1.05
      cls: 0.55
      dfl: 1.0
      close_mosaic: 12
      run_name: 'train_stage_coarse'
    - name: 'finetune'
      epochs: 40
      freeze_layers: 0
      dropout_rate: 0.05
      dropout_layers: 1
      pruning_amount: 0.0
      lr0: 0.006
      lrf: 0.006
      mosaic: 0.0
      copy_paste: 0.35
      mixup: 0.0
      cutmix: 0.0
      erasing: 0.15
      auto_augment: 'augmix'
      scale: 0.45
      box: 1.25
      dfl: 1.15
      cls: 0.45
      close_mosaic: 1
      conf_thres: 0.001
      iou_thres: 0.7
      run_name: 'train_stage_finetune'

# 验证参数
validation:
  val_interval: 1  # 每N个epoch验证一次
  save_period: 5  # 每N个epoch保存一次
  conf_thres: 0.001  # 置信度阈值
  iou_thres: 0.65     # NMS的IoU阈值
  split: 'val'

# 输出路径
paths:
  weights: 'models/'
  results: 'results/'
  logs: 'logs/'

# 报告配置
report:
  output: 'results/eval_report.md'
  include_images:
    - BoxPR_curve.png
    - BoxP_curve.png
    - BoxR_curve.png
    - BoxF1_curve.png
    - confusion_matrix.png
